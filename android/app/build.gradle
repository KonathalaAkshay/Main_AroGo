apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"

/**
 * React Native Android app config
 */
react {
  autolinkLibrariesWithApp()
  // If you want to force Hermes here (optional if already set elsewhere)
  // enableHermes true
}

/** Run R8/Proguard on Release builds */
def enableProguardInReleaseBuilds = true

/** JSC fallback if Hermes is disabled */
def jscFlavor = 'io.github.react-native-community:jsc-android:2026004.+'

android {
  ndkVersion rootProject.ext.ndkVersion
  buildToolsVersion rootProject.ext.buildToolsVersion
  compileSdk rootProject.ext.compileSdkVersion

  namespace "com.arohago"

  defaultConfig {
    applicationId "com.arohago"
    minSdkVersion rootProject.ext.minSdkVersion
    targetSdkVersion rootProject.ext.targetSdkVersion
    versionCode 1
    versionName "1.0"

    // Keep only the locales you need (saves resources)
    resConfigs "en"
    // Use vector drawables (smaller than PNGs in many cases)
    vectorDrawables.useSupportLibrary = true
  }

  signingConfigs {
    debug {
      storeFile file('debug.keystore')
      storePassword 'android'
      keyAlias 'androiddebugkey'
      keyPassword 'android'
    }
    // TODO: create a real release keystore for production
    release {
      // update these when you have your keystore
      storeFile file('debug.keystore')
      storePassword 'android'
      keyAlias 'androiddebugkey'
      keyPassword 'android'
    }
  }

  /**
   * Split per ABI to cut APK size (Play AAB will also split on device)
   */
  splits {
    abi {
      enable true
      reset()
      include "armeabi-v7a", "arm64-v8a" // add x86/x86_64 only if needed
      universalApk false
    }
  }

  /**
   * Recommended splits for AAB
   */
  bundle {
    abi { enableSplit = true }
    density { enableSplit = true }
    language { enableSplit = false }
  }

  buildTypes {
    // Fast dev build
    debug {
      signingConfig signingConfigs.debug
      minifyEnabled false
      shrinkResources false
    }

    // Small, debuggable APK for QA/internal testing
    debugMinified {
      initWith debug
      matchingFallbacks = ['debug']
      debuggable true

      minifyEnabled true
      shrinkResources true
      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
      signingConfig signingConfigs.debug
    }

    // Store/production build
    release {
      signingConfig signingConfigs.release
      minifyEnabled enableProguardInReleaseBuilds
      shrinkResources true
      proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
    }
  }

  /**
   * Trim extra META-INF and other unneeded files
   */
  packagingOptions {
    resources {
      excludes += [
        "META-INF/*.kotlin_module",
        "META-INF/LICENSE*",
        "META-INF/AL2.0",
        "META-INF/LGPL2.1"
      ]
    }
  }
}

dependencies {
  // React Native is managed by the RN Gradle plugin
  implementation("com.facebook.react:react-android")

  // Use Hermes if enabled (recommended for size/startup)
  if (hermesEnabled.toBoolean()) {
    implementation("com.facebook.react:hermes-android")
  } else {
    implementation jscFlavor
  }
}

/**
 * ------------------------------------------------------------------------
 * react-native-vector-icons configuration
 * ------------------------------------------------------------------------
 */
project.ext.vectoricons = [
  iconFontNames: [
    'MaterialCommunityIcons.ttf',
    // add more only if used:
    // 'Ionicons.ttf',
    // 'FontAwesome.ttf',
  ]
]
apply from: "../../node_modules/react-native-vector-icons/fonts.gradle"
